{"componentChunkName":"component---src-templates-blog-post-js","path":"/using-resource-account-context-key-to-scope-down-iam-role-permissions/","webpackCompilationHash":"b1bb345794198b5229c0","result":{"data":{"site":{"siteMetadata":{"title":"Coding Comrade","author":"Eugene Yamenko","siteUrl":"https://CodingComrade.com"}},"markdownRemark":{"id":"90db562f-102f-52c9-a5d6-351ff4afe22f","excerpt":"AWS Identity and Access Management (IAM) is a service that allows to control access to AWS resources. IAM supports various identities, including IAM roles. An…","html":"<p>AWS Identity and Access Management (IAM) is a service that allows to control access to AWS resources. IAM supports various identities, including IAM roles. An IAM role contains permission policies that describe what the identity can and cannot do in AWS.</p>\n<p>Often, permissions need to be scoped down based on a context. For example, one may want to grant an IAM role permission to assume an IAM role, but only if the role belongs to a specific account.</p>\n<p>There are two traditional approaches to scoping down IAM role permissions in this case:</p>\n<ul>\n<li>Creating unique IAM roles for each required account: This approach is not scalable, as IAM has a default quota of 1000 roles per account.</li>\n<li>Passing an inline policy to STS in the <code class=\"language-text\">AssumeRole</code> call: This approach can exceed the maximum size for session tokens, which can result in the <code class=\"language-text\">PackedPolicyTooLarge</code> error.</li>\n</ul>\n<p>Fortunately, there is now a workaround for this. IAM supports a large number of <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html\">different context keys</a>, and one of them is the <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-resourceaccount\">ResourceAccount</a> context key. This context key can be used to check whether the resource account is equal to something, where “something” can be a session tag included in the session.</p>\n<p>Using the <code class=\"language-text\">ResourceAccount</code> context key has several benefits:</p>\n<ul>\n<li>It allows to scope down IAM role permissions without a need to create many IAM roles.</li>\n<li>It saves precious space in session tokens, which can help to avoid the <code class=\"language-text\">PackedPolicyTooLarge</code> error.</li>\n</ul>\n<p>The following example shows how to use the <code class=\"language-text\">ResourceAccount</code> context key to scope down IAM role permissions:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"sts:AssumeRole\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"arn:aws:iam::*:role/sample-role-to-assume\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Condition\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"StringEquals\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"aws:ResourceAccount\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"${aws:PrincipalTag/SessionAccountID}\"</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In this example, the IAM role will only be able to assume the <code class=\"language-text\">sample-role-to-assume</code> role if the AWS account ID of the resource matches the <code class=\"language-text\">SessionAccountID</code> session tag.</p>\n<p>The <code class=\"language-text\">ResourceAccount</code> context key is a powerful tool that can be used to scope down IAM role permissions. It is a more scalable and efficient approach than the traditional methods, and it can help to avoid the <code class=\"language-text\">PackedPolicyTooLarge</code> error.</p>\n<p>Happy coding!</p>","frontmatter":{"title":"Using ResourceAccount context key to scope down IAM role permissions","date":"November 27, 2023","description":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/using-resource-account-context-key-to-scope-down-iam-role-permissions/","previous":{"fields":{"slug":"/running-microsoft-orleans-in-aws-ecs/"},"frontmatter":{"title":"Running Microsoft Orleans in AWS ECS"}},"next":{"fields":{"slug":"/efficient-way-to-select-the-first-row-from-each-group-in-postgresql/"},"frontmatter":{"title":"Efficient way to select the first row from each group in PostgreSQL"}}}}}